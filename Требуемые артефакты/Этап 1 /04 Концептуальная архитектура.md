## 4. Концептуальная архитектура

## 4.1 Архитектурный стиль и ключевые принципы

В основе системы лежит микросервисная архитектура, дополненная event-driven подходом для асинхронного взаимодействия между компонентами.

### Ключевые архитектурные принципы

**Разделение по доменам (Domain-Driven Design)**  
Каждый сервис отвечает за один бизнес-домен и владеет своими данными.

**Слабая связанность сервисов**  
Взаимодействие между сервисами осуществляется через API и события.

**Event-driven архитектура**  
Ключевые бизнес-события (завершение тренировки, достижение, участие в соревновании) публикуются в event bus и обрабатываются асинхронно.

**Cloud-native подход**  
Все сервисы развёртываются в контейнерах и управляются оркестратором (Kubernetes).

**Multi-cloud и multi-region готовность**  
Архитектура допускает развёртывание в нескольких регионах и облаках.


## 4.2 Обзор основных доменов и сервисов

Система разделена на несколько ключевых доменов:

### Пользовательский домен
- **User Service** — управление пользователями и профилями.  
- **Auth Service** — аутентификация и авторизация (SSO).

### Домен тренировок и телеметрии
- **Training Service** — фиксация и управление тренировками.  
- **Telemetry Ingestion Service** — приём данных от устройств.  
- **Analytics Service** — агрегация и анализ тренировочных данных.

### Социальный домен
- **Social Service** — группы, подписки, взаимодействия.  
- **Notification Service** — уведомления и события активности.

### Домен рекомендаций и персонализации
- **Recommendation Service** — рекомендации тренировок и экипировки.  
- **ML Platform** — обучение и применение моделей.

### Коммерческий и интеграционный домен
- **Store Integration Service** — интеграция с e-commerce.  
- **Promotion Service** — промоакции и кампании.

### Аналитический домен
- **Event Streaming Platform** — события системы.  
- **Data Lake** — хранение данных для аналитики.


## 4.3 Базовая архитектурная диаграмма
<img width="848" height="602" alt="image" src="https://github.com/user-attachments/assets/ee287f0a-ba9a-4338-8a5d-3751e9737940" />

## 4.4 Основные модели данных

Ниже представлены ключевые логические модели данных системы.

### User
- user_id  
- email  
- region  
- preferences  
- created_at  

### Training
- training_id  
- user_id  
- type  
- duration  
- metrics (distance, pace, calories)  
- timestamp  

### TelemetryEvent
- device_id  
- user_id  
- metric_type  
- value  
- timestamp  

### SocialGroup
- group_id  
- type  
- region  
- members  

### Achievement
- achievement_id  
- user_id  
- type  
- awarded_at  

### InventoryItem
- item_id  
- brand  
- category  
- usage_stats  

### Recommendation
- recommendation_id  
- user_id  
- type (training / equipment)  
- context  
- created_at  


## 4.5 Типы баз данных и обоснование выбора

| Домен            | Тип БД              | Обоснование                |
|------------------|---------------------|----------------------------|
| Пользователи     | Реляционная (PostgreSQL) | Консистентность, транзакции |
| Тренировки       | Реляционная         | Связанные данные           |
| Телеметрия       | Time-series DB      | Высокая частота записей    |
| Социальные данные| Graph DB            | Сложные связи              |
| Рекомендации     | NoSQL               | Гибкость схемы             |
| События          | Event Store         | Event sourcing             |
| Аналитика        | Data Lake           | Масштабируемость           |


## 4.6 Потоки данных в системе

1. Пользователь фиксирует тренировку.  
2. Данные отправляются в Training Service.  
3. Телеметрия поступает через ingestion-слой.  
4. События публикуются в Event Bus.  
5. Аналитика и рекомендации обрабатываются асинхронно.  
6. Результаты отображаются пользователю и используются для коммерческих сценариев.  


## 4.7 Выводы по архитектуре

Выбранная архитектура обеспечивает:

- масштабируемость при росте пользователей и устройств;
- устойчивость к пиковым нагрузкам;
- гибкость развития функциональности;
- возможность глубокой аналитики и персонализации;
- безопасную интеграцию с существующей e-commerce экосистемой.
