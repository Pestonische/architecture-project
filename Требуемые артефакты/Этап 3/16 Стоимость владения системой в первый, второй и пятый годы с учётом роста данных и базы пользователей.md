## 16. Стоимость владения системой (TCO)

## 16.1 Структура затрат: CAPEX и OPEX

### 16.1.1 CAPEX — капитальные затраты

Капитальные затраты включают единовременные инвестиции, необходимые для создания и запуска системы:

- архитектурное проектирование и разработка концепции системы;
- разработка MVP и базовых микросервисов;
- реализация интеграций с существующими системами компании (e-commerce, Identity, аналитика);
- внедрение CI/CD, observability и базовых механизмов безопасности;
- первичная настройка облачной инфраструктуры и сетевого взаимодействия;
- подготовка документации и архитектурных решений (ADR).

CAPEX преимущественно приходится на начальные этапы проекта и формирует фундамент, позволяющий в дальнейшем масштабировать систему без дорогостоящих архитектурных изменений.

### 16.1.2 OPEX — операционные затраты

Операционные затраты формируются на протяжении всего срока эксплуатации системы и напрямую зависят от объёма нагрузки и степени использования функциональности:

- вычислительные ресурсы (Kubernetes-кластеры, autoscaling);
- сетевой трафик и межрегиональные соединения;
- CDN и edge-инфраструктура;
- хранение данных:
  - транзакционные базы данных;
  - time-series хранилища телеметрии;
  - аналитические хранилища и Data Lake;
- интеграционные компоненты:
  - event streaming;
  - очереди сообщений;
  - API Gateway;
- эксплуатация и поддержка:
  - DevOps / SRE;
  - мониторинг и observability;
  - безопасность и compliance;
  - поддержка CI/CD и тестовых окружений.

OPEX растёт пропорционально пользовательской активности и объёму данных, однако за счёт cloud-native архитектуры рост остаётся контролируемым и предсказуемым.


## 16.2 Предположения для оценки стоимости

Для оценки TCO используются следующие допущения по росту системы:

| Параметр | Год 1 | Год 2 | Год 5 |
|---------|-------|-------|-------|
| Активные пользователи (MAU) | ~100 тыс. | ~1 млн | ~10 млн |
| Подключённые устройства | ~50 тыс. | ~500 тыс. | ~5 млн |
| Объём телеметрии | ~5 ТБ | ~50 ТБ | ~500+ ТБ |
| Регионов развёртывания | 1–2 | 3–4 | 5+ |

Данные значения отражают умеренно агрессивный сценарий роста глобального продукта.


## 16.3 Стоимость владения — Год 1 (MVP и ранний рост)

### Характеристика периода
- один основной регион развёртывания;
- минимальный набор сервисов;
- ограниченная аналитика;
- небольшая команда эксплуатации;
- основной фокус — скорость вывода продукта на рынок.

### Распределение OPEX

| Категория | Доля затрат |
|-----------|-------------|
| Compute (Kubernetes) | ~40% |
| Хранилища данных | ~25% |
| Event Bus и очереди | ~10% |
| CDN и сетевой трафик | ~10% |
| Observability и безопасность | ~10% |
| Прочее | ~5% |

### Вывод по году 1
Несмотря на относительно высокую долю инфраструктурных затрат, архитектура сразу закладывается «на рост», что позволяет избежать дорогостоящих миграций на следующих этапах.


## 16.4 Стоимость владения — Год 2 (активный рост)

### Изменения по сравнению с годом 1
- рост пользовательской базы на порядок;
- значительное увеличение количества подключённых устройств;
- активное использование аналитики и рекомендаций;
- расширение географии развёртывания.

### Дополнительные статьи OPEX
- масштабирование ingestion-слоя;
- рост объёмов хранилищ;
- дублирование инфраструктуры по регионам;
- увеличение затрат на эксплуатацию и мониторинг.

### Распределение OPEX

| Категория | Доля затрат |
|-----------|-------------|
| Compute (Kubernetes) | ~35% |
| Хранилища и Data Lake | ~30% |
| Event Streaming | ~15% |
| Сеть и CDN | ~10% |
| Эксплуатация | ~10% |

### Вывод по году 2
На данном этапе архитектурные решения начинают окупаться: система масштабируется без рефакторинга, а рост затрат остаётся линейным относительно роста нагрузки.


## 16.5 Стоимость владения — Год 5 (глобальная платформа)

### Характеристика периода
- глобальная пользовательская база;
- большие объёмы исторических данных;
- развитые ML-модели и персонализация;
- высокие требования к SLA и доступности.

### Основные драйверы OPEX
- хранение и аналитическая обработка данных;
- межрегиональный сетевой трафик;
- эксплуатация multi-cloud окружения;
- поддержка высоких стандартов безопасности.

### Распределение OPEX

| Категория | Доля затрат |
|-----------|-------------|
| Data Lake и аналитика | ~35% |
| Compute | ~30% |
| Event Streaming | ~15% |
| Сеть и CDN | ~10% |
| Эксплуатация и безопасность | ~10% |

### Вывод по году 5
Основным активом системы становятся данные и аналитика. Стоимость инфраструктуры растёт медленнее, чем пользовательская база, за счёт оптимизации и накопленного опыта эксплуатации.


## 16.6 Влияние архитектуры на стоимость

### Положительное влияние
- отсутствие необходимости в крупных миграциях;
- независимое масштабирование компонентов;
- эффективное использование облачных ресурсов;
- возможность оптимизации затрат на каждом домене отдельно.

### Отрицательное влияние
- более высокая стартовая сложность;
- дополнительные затраты на observability, безопасность и SRE;
- необходимость инвестиций в экспертизу команды.


## 16.7 Итоговые выводы по TCO

- архитектура экономически оправдана на горизонте 3–5 лет;
- первоначальные CAPEX компенсируются снижением рисков и гибкостью масштабирования;
- OPEX растёт линейно и предсказуемо;
- event-driven и микросервисный подход позволяют избежать взрывного роста затрат;
- система готова к долгосрочной эволюции без радикальных архитектурных переделок.
